# 不動産ポータルサイト 設計概要（改訂版）

## 1. システム全体構成（改訂版）

### 現在フェーズ（MVP〜初期運用）

* **Webフロントエンド（LP + Webアプリ）**

  * Next.js（React + TypeScript）
* **バックエンド API**

  * Go / Gin / GORM / MySQL
  * モノリシックAPI構成
* **インフラ（本番）**

  * **シンVPS**
  * Docker または 単体プロセスでデプロイ
* **開発環境**

  * Docker（backend / web / db / 将来 docs）

### 将来フェーズ（スケール・拡張）

* **モバイルアプリ（将来構想・当面は未実装）**

  * Flutter（iOS / Android）
* **インフラ拡張**

  * AWS（ECS / EKS / EC2 + RDS）
* **外部連携**

  * LINE / Instagram 共有
  * Push通知（FCM）

### 全体構成イメージ

```
[ Next.js Web (LP + App) ]
            ↓
        [ Go API ]
            ↓
   [ MySQL / Redis / 外部API ]
```

※ 当面 Flutter クライアントは存在しない
※ API設計は将来のモバイル対応を前提にしておく

---

## 2. 技術スタック（改訂版）

## 2.1 Webフロントエンド（Next.js）

| 項目      | 技術                                            |
| ------- | --------------------------------------------- |
| 言語      | TypeScript                                    |
| フレームワーク | Next.js 14（App Router） + React 18             |
| レンダリング  | SSG / SSR / CSR                               |
| 方針      | LP・OGPはSSG / アプリ部分はCSR寄り                      |
| スタイリング  | Tailwind CSS + Radix UI                       |
| 状態管理    | React Query（Server State） + Zustand（UI State） |
| ルーティング  | Next.js App Router（`app/`）                    |
| フォーム    | React Hook Form + Zod                         |
| HTTP    | fetch wrapper or axios（React Query経由）         |
| 認証      | Cookieベース（HttpOnly Cookie推奨）                  |
| テスト     | Vitest or Jest / React Testing Library        |
| 静的解析    | ESLint / Prettier                             |
| 画像生成    | OGP / ストーリー共有用画像（Puppeteer等）                  |

> 既存の **React + Vite 構成は Next.js に置き換え**
> SEO・OGP・URL共有を最優先するため

---

## 2.2 バックエンド（Go API）

| 項目            | 技術                      |
| ------------- | ----------------------- |
| 言語            | Go 1.22+                |
| Web Framework | Gin                     |
| ORM           | GORM                    |
| DB            | MySQL 8.x               |
| Migration     | golang-migrate          |
| Validation    | go-playground/validator |
| Logger        | zap または zerolog         |
| DI            | コンストラクタDI（必要に応じて wire）  |
| APIドキュメント     | OpenAPI（swaggo/swag）    |
| 認証            | JWT（Access + Refresh）   |
| レート制限         | Gin middleware / Nginx  |
| 環境変数          | Viper                   |
| バックグラウンド処理    | cron / asynq            |

### API型安全性（将来対応）

* OpenAPI を正とする
* 型自動生成：

  * TypeScript：`openapi-typescript`
  * Flutter（将来）：`openapi-generator (Dart)`

---

## 2.3 モバイルアプリ（将来構想・当面未実装）

> **このセクションは設計のみ。実装は行わない**

| 項目      | 技術                          |
| ------- | --------------------------- |
| 言語      | Dart                        |
| フレームワーク | Flutter 3.x                 |
| 状態管理    | Riverpod（推奨）                |
| ルーティング  | go_router                   |
| HTTP    | dio                         |
| JSON    | json_serializable + freezed |
| 認証      | JWT（Secure Storage）         |
| 通知      | Firebase Cloud Messaging    |

### 想定役割（将来）

---

## 2.4 共通・横断的設計

### 認証・セッション方針

**Web（Next.js）**

* HttpOnly Cookie
* React Query でAPI呼び出し

**モバイル（将来）**

* JWTをSecure Storageに保存
* Authorizationヘッダで送信

---

### ドメインモデル統一

以下を **同一構造** で持つ：

* Go struct
* OpenAPI schema
* TypeScript type
* Dart model（将来）

例：

* User
* Property
* HiddenProperty
* DiscrepancyReport
* Notification

---

### 通知設計（将来対応）

* Go Backend → NotificationService

  * FCM
  * LINE
  * Email

トリガー例：

* 新着物件
* 相違報告増加
* 条件一致

---

## 3. この構成のポイント

* **WebはNext.jsに寄せ、SEO・OGP・共有に強くする**
* **APIはGoに集約し、ロジックを一元管理**
* **モバイルは将来追加できるが、今は作らない**
* **シンVPS前提で、Docker or 単体運用が可能**
* **AWS移行時も構成を壊さずスケール可能**

---

## 4. フェーズ整理

### Phase 1（今）

* Next.js Web
* Go API
* MySQL
* シンVPS
* スクレイピングPoC

### Phase 2（伸びたら）

* 検索最適化
* Redis / 非同期処理
* 通知基盤

### Phase 3（将来）

* Flutterアプリ
* AWS移行
* 提携・公式データ連携

---

このMarkdownはそのまま：

* README
* 設計書
* 企画書
* チーム共有ドキュメント

に使えます。

次にやるとしたらおすすめは
**「インフラ構成（シンVPSでのDocker/非Docker設計）」**
か
**「DB設計（毎日更新・削除を前提にしたER図）」**

どちらをまとめますか？
